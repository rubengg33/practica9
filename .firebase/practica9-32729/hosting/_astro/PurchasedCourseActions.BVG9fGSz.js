import{j as e}from"./jsx-runtime.CLpGMVip.js";import{r as n}from"./index.BL7xzsR_.js";import{a as h,B as f}from"./button.NJqs0wxn.js";const g=s=>{const[a,t]=n.useState([]);return n.useEffect(()=>{if(!s){t([]);return}(async()=>{try{const o=await(await fetch(`https://firestore.googleapis.com/v1/projects/practica9-32729/databases/(default)/documents/purchases/${s}/courses`)).json();if(!o.documents){t([]);return}const c=o.documents.map(d=>d.name.split("/").pop());t(c)}catch(r){console.error("Error obteniendo compras:",r),t([])}})()},[s]),a},x=({course:s})=>{const a=async()=>{const t=localStorage.getItem("userId"),l=localStorage.getItem("token");if(!t||!l){alert("Debes iniciar sesión para añadir cursos al carrito.");return}try{await h(t,s)===!0&&alert("Curso añadido al carrito!")}catch(r){console.error("Error al añadir al carrito:",r)}};return e.jsx("button",{onClick:a,className:"p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600",children:e.jsx("img",{src:"../anadir-a-la-cesta.png",alt:"Añadir",className:"w-5 h-5"})})},b=({isOpen:s,onClose:a,videoUrl:t,temario:l})=>{const r=n.useRef(null);n.useEffect(()=>{const c=r.current;s&&c?c.showModal():c&&c.close()},[s]);const o=()=>{r.current?.close(),a()};return console.log("Dialog props:",{videoUrl:t,temario:l}),e.jsxs("dialog",{ref:r,className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl backdrop:bg-black backdrop:bg-opacity-50",onClose:o,children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Contenido del Curso"}),e.jsx("div",{className:"mb-4 relative pt-[56.25%]",children:t&&e.jsx("iframe",{className:"absolute top-0 left-0 w-full h-full",src:t,title:"Video del curso",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Temario:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:l?.map((c,d)=>e.jsx("li",{children:c},d))})]}),e.jsx("div",{className:"flex justify-end space-x-2 mt-4",children:e.jsx(f,{variant:"secondary",onClick:o,children:"Cerrar"})})]})},j=({courseId:s,videoUrl:a,temario:t})=>{const[l,r]=n.useState(!1),o=()=>{console.log("Opening dialog with:",{courseId:s,videoUrl:a,temario:t}),r(!0)},c=()=>{r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o,className:"bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700",children:"Ver Contenido"}),e.jsx(b,{isOpen:l,onClose:c,videoUrl:a,temario:Array.isArray(t)?t:[]})]})},I=({course:s})=>{const[a,t]=n.useState(null),l=g(a),[r,o]=n.useState(!1);n.useEffect(()=>{const i=()=>{const p=localStorage.getItem("token"),u=localStorage.getItem("userId");if(!p||!u){t(null),o(!1);return}t(u)};i();const m=setInterval(i,1e3);return()=>{clearInterval(m),t(null),o(!1)}},[]),n.useEffect(()=>{if(!a||!l){o(!1);return}const i=l.includes(s.id);o(i)},[l,s.id,a]);const c=s.videoUrl,d=s.temario?.values?.map(i=>i.stringValue)||[];return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"price-display text-lg font-semibold text-gray-800","data-price":s.precio,children:s.precio}),r&&a?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-green-600 font-bold",children:"¡Curso comprado!"}),e.jsx(j,{courseId:s.id,videoUrl:c,temario:d})]}):e.jsx(x,{course:s})]})};export{I as default};
