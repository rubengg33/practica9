import{j as e}from"./jsx-runtime.CLpGMVip.js";import{r as o}from"./index.BL7xzsR_.js";import{B as h,g,r as j}from"./button.NJqs0wxn.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),w=(...s)=>s.filter((r,a,l)=>!!r&&r.trim()!==""&&l.indexOf(r)===a).join(" ").trim();/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var y={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=o.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:l,className:c="",children:n,iconNode:d,...m},f)=>o.createElement("svg",{ref:f,...y,width:r,height:r,stroke:s,strokeWidth:l?Number(a)*24/Number(r):a,className:w("lucide",c),...m},[...d.map(([u,x])=>o.createElement(u,x)),...Array.isArray(n)?n:[n]]));/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=(s,r)=>{const a=o.forwardRef(({className:l,...c},n)=>o.createElement(v,{ref:n,iconNode:r,className:w(`lucide-${C(s)}`,l),...c}));return a.displayName=`${s}`,a};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],k=b("Trash2",N),S=({courses:s,total:r,isOpen:a,onClose:l,onConfirm:c,currency:n})=>{const d=o.useRef(null);return o.useEffect(()=>{a?d.current?.showModal():d.current?.close()},[a]),e.jsxs("dialog",{ref:d,className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Confirmar compra"}),e.jsx("div",{className:"space-y-2",children:s.map(m=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:m.titulo}),e.jsxs("span",{children:[n," ",m.precio.toFixed(2)]})]},m.id))}),e.jsxs("div",{className:"flex justify-between mt-4 font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[n," ",r]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(h,{variant:"secondary",onClick:l,children:"Cancelar"}),e.jsx(h,{className:"bg-green-600 text-white",onClick:c,children:"Confirmar compra"})]})]})},E=({userId:s})=>{const[r,a]=o.useState([]),[l,c]=o.useState(!1),[n,d]=o.useState("USD");o.useEffect(()=>{console.log("userId recibido en Cart.tsx:",s),(async()=>{const i=await g(s);a(i)})()},[s]),o.useEffect(()=>{const t=i=>{i.key==="currency"&&d(i.newValue||"USD")};return window.addEventListener("storage",t),d(localStorage.getItem("currency")||"USD"),()=>{window.removeEventListener("storage",t)}},[]);const m=t=>(t*{EUR:.91,GBP:.79,USD:1}[n]).toFixed(2),f=async t=>{await j(s,t),a(i=>i.filter(p=>p.id!==t))},u=()=>m(r.reduce((t,i)=>t+i.precio,0)),x=async()=>{try{if(!s){alert("Debes iniciar sesiÃ³n para comprar.");return}for(const t of r){const i=`https://firestore.googleapis.com/v1/projects/practica9-32729/databases/(default)/documents/purchases/${s}/courses/${t.id}`;await fetch(i,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({fields:{purchaseDate:{timestampValue:new Date().toISOString()}}})})}for(const t of r)await j(s,t.id);a([]),c(!1),alert("Â¡Compra realizada con Ã©xito! ðŸŽ‰")}catch(t){console.error("Error al finalizar la compra:",t),alert("Hubo un problema al procesar la compra. IntÃ©ntalo de nuevo.")}};return e.jsxs("div",{className:"w-full max-w-md bg-white shadow-lg rounded-lg p-6 space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-4",children:"Carrito de Cursos"}),e.jsx("div",{className:"space-y-4",children:r.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:t.imagen,alt:t.titulo,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"font-semibold",children:t.titulo}),e.jsxs("p",{className:"text-sm text-gray-500",children:[n," ",m(t.precio)]})]})]}),e.jsx(h,{variant:"destructive",size:"icon",className:"h-8 w-8 ml-2",onClick:()=>f(t.id),children:e.jsx(k,{className:"h-4 w-4"})})]},t.id))}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("span",{className:"text-lg font-bold",children:"Total:"}),e.jsxs("span",{className:"text-xl font-bold",children:[n," ",u()]})]}),e.jsx(h,{className:"text-white bg-green-600",onClick:()=>c(!0),children:"Finalizar Compra"}),e.jsx(S,{courses:r,total:u(),isOpen:l,onClose:()=>c(!1),onConfirm:x,currency:n})]})},T=()=>{const[s,r]=o.useState([]),[a,l]=o.useState("");return o.useEffect(()=>{const c=localStorage.getItem("userId");c&&(l(c),g(c).then(n=>r(n)))},[]),e.jsx(E,{courses:s,userId:a})};export{T as default};
